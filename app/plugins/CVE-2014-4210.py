# -*- encoding: utf-8 -*-
'''
@File : CVE-2014-4210.py
@Time : 2019/08/02 10:49:08
@Author : JE2Se 
@Version : 1.0
@Contact : admin@je2se.com
@WebSite : https://www.je2se.com
'''




import logging
import sys
import requests

from ..platform import ManageProcessor
from lib import *

_tiemout = 10

logging.basicConfig(filename='Weblogic.log',
                    format='%(asctime)s %(message)s',
                    filemode="w", level=logging.INFO)

headers = {'user-agent': 'ceshi/0.0.1'}


@ManageProcessor.plugin_register('SSRF')
class SSRF(object):
    def process(self,ip,port):
        self.run(ip,port)

    def islive(self,ur,port):
        url='http://' + str(ur)+':'+str(port)+'/uddiexplorer/'
        r = requests.get(url, headers=headers , timeout=_tiemout)
        return r.status_code

    def run(self,url,port):
        if self.islive(url,port)==200:
            u='http://' + str(url)+':'+str(port)+'/uddiexplorer/'
            logging.info('[+]The target Weblogic UDDI module is exposed! The path is: {} Please verify the SSRF vulnerability!'.format(u))
            print(Vcolors.OKBLUE+'[+]The target Weblogic UDDI module is exposed!\n[+]The path is: {}\n[+]Please verify the SSRF vulnerability!'.format(u)+Vcolors.ENDC)
            print(Vcolors.OKGREEN+'[+]SSRF 漏洞存在'+Vcolors.ENDC)
        else:
            logging.info("[-]The target Weblogic UDDI module default path does not exist!")
            print(Vcolors.FAIL+"[-]The target Weblogic UDDI module default path does not exist!"+Vcolors.ENDC)