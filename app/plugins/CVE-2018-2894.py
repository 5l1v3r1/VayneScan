# -*- encoding: utf-8 -*-
'''
@File : CVE-2018-2894.py
@Time : 2019/07/06 01:42:03
@Author : JE2Se 
@Version : 1.0
@Contact : admin@je2se.com
@WebSite : https://www.je2se.com
'''



import requests
import re
import logging


from ..platform import ManageProcessor
from lib import *

logging.basicConfig(filename='Weblogic.log',
                    format='%(asctime)s %(message)s',
                    filemode="w", level=logging.INFO)

VUL=['CVE-2018-2894']
headers = {'user-agent': 'ceshi/0.0.1'}

@ManageProcessor.plugin_register('CVE20182894')
class CVE20182894(object):
    def process(self,ip,port):
        self.run(ip,port,0)

    def islive(self,ur,port):
        url='http://' + str(ur)+':'+str(port)+'/ws_utc/resources/setting/options/general'
        r = requests.get(url, headers=headers)
        return r.status_code

    def run(self,url,port,index):
        if self.islive(url,port)!=404:
            logging.info('[+]The target weblogic has a JAVA deserialization vulnerability:{}'.format(VUL[index]))
            print(Vcolors.OKBLUE+'[+]The target weblogic has a JAVA deserialization vulnerability:{}'.format(VUL[index])+Vcolors.ENDC)
            print(Vcolors.OKGREEN+'[+]CVE-2018-2894 漏洞存在'+Vcolors.ENDC)
        else:
            logging.info('[-]Target weblogic not detected {}'.format(VUL[index]))
            print(Vcolors.FAIL+'[-]Target weblogic not detected {}'.format(VUL[index])+Vcolors.ENDC)
